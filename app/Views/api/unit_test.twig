{% extends 'api.layout' %}

{% block title %}当老师 - 单元测试 {% endblock %}

{% block customStyle %}
  #vld-tooltip {
    position: absolute;
    z-index: 1000;
    padding: 5px 10px;
    background: #F37B1D;
    min-width: 150px;
    color: #fff;
    transition: all 0.15s;
    box-shadow: 0 0 5px rgba(0,0,0,.15);
    display: none;
  }

  #vld-tooltip:before {
    position: absolute;
    top: -8px;
    left: 50%;
    width: 0;
    height: 0;
    margin-left: -8px;
    content: "";
    border-width: 0 8px 8px;
    border-color: transparent transparent #F37B1D;
    border-style: none inset solid;
  }
{% endblock %}

{% block header %}
    <div class="header">
        <div class="am-g">
            <h1>API手动测试</h1>
        </div>
        <hr />
    </div>
{% endblock %}

{% block content %}
    <div class="am-panel am-panel-danger am-u-sm-6 am-u-sm-centered am-padding">
        <div class="am-panel-body">
            <form id="_frm_test" action="/api/auth/register/set_password" class="am-form">
                <div class="am-form-group">
                    <label class='am-form-label'>API地址</label>
                   <input id="_api" type='text' placeholder="输入API地址" value="" /> 
                </div>
                <div class="am-form-group">
                    <label class="am-form-label">访问方法</label>
                    <select id="_method" data-am-selected>
                        <option value="POST" selected="selected">POST</option>
                        <option value="GET">GET</option>
                        <option value="PUT">PUT</option>
                        <option value="PATCH">PATCH</option>
                        <option value="DELETE">DELETE</option>
                    </select>
                </div>
                <div class="am-form-group">
                    <label class="am-form-label">头部</label>
                    <textarea rows="5" id="_headers"></textarea>
                </div>
                <div class="am-form-group">
                    <label class="am-form-label">参数</label>
                    <textarea rows="10" id="_params"></textarea>
                </div>
                <div class="am-form-group">
                    <button id="_btn_submit" type="button" class="am-btn am-btn-success">提交</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block bottom %}


<!--[if lt IE 9]>
<script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
<script src="assets/js/amazeui.ie8polyfill.min.js"></script>
<![endif]-->

<!--[if (gte IE 9)|!(IE)]><!-->
<script src="/assets/api/js/jquery.min.js"></script>
<!--<![endif]-->
<script src="/assets/api/js/amazeui.min.js"></script>
<script src="/assets/api/js/validator.js"></script>
<script type="text/javascript">
    (function($) {
/**
 * @Author:      Alvin
 * @Email:       jin@aliuda.com
 * @DateTime:    2015-10-28 13:34:33
 * @Description: 表单验证方法
 */
/*
        var $form = $('#_frm_check_phone');
        var $tooltip = $('<div id="vld-tooltip">提示信息！</div>');
        $tooltip.appendTo(document.body);
        $form.validator();
        var validator = $form.data('amui.validator');
        $form.on('focusin focusout', '.am-form-error input', function(e) {
            if (e.type === 'focusin') {
                var $this = $(this);
                var offset = $this.offset();
                var msg = $this.data("validationMessage") || validator.getValidationMessage($this.data('validity'));
                $tooltip.text(msg).show().css({
                    left: offset.left + 10,
                    top: offset.top + $(this).outerHeight() + 10
                });
            } else {
                $tooltip.hide();
            }
        });
*/ 

        $("#_btn_submit").on('click', function(){
            $postPath = $("#_api").val();
            $postMethod = $("#_method").val() || 'POST';
            $postHeader = $("#_headers").val();
            $postParams = $("#_params").val();

            if ( !$postPath )
            {
                alert('API地址不能为空');
                return false;
            }

            $postHeader = $postHeader.replace(/\r/ig, "");
            $postParams = $postParams.replace(/\r/ig, "").replace(/\n/ig,"&");
            $.ajax({
                url: window.location.origin + '/' + $postPath,
                cache:false,
                data:$postParams,
                dataType:'json',
                type: $postMethod,
                complete:function(result) {
                    console.log(result.responseText)
                },
                beforeSend: function(xhr) {
                    $postHeader = $postHeader.split(/\n/ig);
                    for($x in $postHeader)
                    {
                        $tmp = $postHeader[$x].split("=");
                        if ( $tmp.length == 2 )
                        {
                            xhr.setRequestHeader($tmp[0], $tmp[1]);
                        }
                    }
                }
            });
            
        });
    })(jQuery);
</script>
{% endblock %}
  
